{% extends "base.html" %}

{% block content %}
<div class="admin-container">
    <h1>Административная панель</h1>
    
    <!-- Навигационные табы -->
    <div class="nav-tabs">
        <div class="nav-tab" onclick="showTable('users')">Пользователи</div>
        <div class="nav-tab" onclick="showTable('products')">Продукты</div>
        <div class="nav-tab" onclick="showTable('carts')">Корзины</div>
        <div class="nav-tab" onclick="showTable('reviews')">Отзывы</div>
    </div>

    <!-- Таблица пользователей -->
    <table class="admin-table" id="users-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Email</th>
                <th>Имя</th>
                <th>Телефон</th>
                <th>Дата рождения</th>
                <th>Роль</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.id }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.full_name }}</td>
                <td>{{ user.phone_number }}</td>
                <td>{{ user.date_of_birth }}</td>
                <td>{{ user.role }}</td>
                <td class="admin-actions">
                    <form action="/admin/reset-password/{{ user.id }}" method="POST">
                        <button type="submit" class="admin-btn btn-reset">Сбросить пароль</button>
                    </form>
                    <form action="/admin/delete-user/{{ user.id }}" method="POST">
                        <button type="submit" class="admin-btn btn-delete">Удалить</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Таблица продуктов -->
    <table class="admin-table" id="products-table" style="display: none;">
        <thead>
            <tr>
                <th>ID</th>
                <th>Название</th>
                <th>Категория</th>
                <th>Цена</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr>
                <td>{{ product.id }}</td>
                <td>{{ product.name }}</td>
                <td>{{ product.category }}</td>
                <td>{{ product.price }} руб.</td>
                <td class="admin-actions">
                    <a href="/admin/edit-product/{{ product.id }}" class="admin-btn btn-reset">Изменить</a>
                    <form action="/admin/delete-product/{{ product.id }}" method="POST">
                        <button type="submit" class="admin-btn btn-delete">Удалить</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Таблица корзин -->
    <table class="admin-table" id="carts-table" style="display: none;">
        <thead>
            <tr>
                <th>ID</th>
                <th>Пользователь</th>
                <th>Продукт</th>
                <th>Количество</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for cart in carts %}
            <tr>
                <td>{{ cart.id }}</td>
                <td>{{ cart.user.email }}</td>
                <td>{{ cart.product.name }}</td>
                <td>{{ cart.quantity }}</td>
                <td class="admin-actions">
                    <form action="/admin/delete-cart/{{ cart.id }}" method="POST">
                        <button type="submit" class="admin-btn btn-delete">Удалить</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Таблица отзывов -->
    <table class="admin-table" id="reviews-table" style="display: none;">
        <thead>
            <tr>
                <th>ID</th>
                <th>Автор</th>
                <th>Текст</th>
                <th>Продукт</th>
                <th>Дата</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for review in reviews %}
            <tr>
                <td>{{ review.id }}</td>
                <td>{{ review.author }}</td>
                <td>{{ review.text|truncate(50) }}</td>
                <td>{{ review.product.name }}</td>
                <td>{{ review.created_at }}</td>
                <td class="admin-actions">
                    <form action="/admin/delete-review/{{ review.id }}" method="POST">
                        <button type="submit" class="admin-btn btn-delete">Удалить</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<div id="add-cart-form" style="display: none;">
    <h2>Добавить в корзину</h2>
    <form action="/admin/add-cart" method="POST">
        <div class="form-group">
            <label>Пользователь:</label>
            <select name="user_id" required>
                {% for user in users %}
                <option value="{{ user.id }}">{{ user.email }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label>Продукт:</label>
            <select name="product_id" required>
                {% for product in products %}
                <option value="{{ product.id }}">{{ product.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label>Количество:</label>
            <input type="number" name="quantity" min="1" required>
        </div>
        <button type="submit" class="admin-btn btn-reset">Добавить</button>
    </form>
</div>

<form id="editProductForm" method="POST">
    <div class="form-group">
        <label>Название:</label>
        <input type="text" name="name" id="editProductName" required>
    </div>
    <div class="form-group">
        <label>Категория:</label>
        <input type="text" name="category" id="editProductCategory" required>
    </div>
    <div class="form-group">
        <label>Цена:</label>
        <input type="number" step="0.01" name="price" id="editProductPrice" required>
    </div>
    <div class="form-group">
        <label>Описание:</label>
        <textarea name="description" id="editProductDescription"></textarea>
    </div>
    <button type="submit" class="admin-btn btn-reset">Сохранить</button>
</form>
<!-- Форма редактирования корзины -->
<div id="edit-cart-form" style="display: none;">
    <h2>Редактировать корзину</h2>
    <form id="editCartForm" method="POST">
        <div class="form-group">
            <label>Количество:</label>
            <input type="number" name="quantity" id="editCartQuantity" min="1" required>
        </div>
        <button type="submit" class="admin-btn btn-reset">Сохранить</button>
    </form>
</div>

<!-- Форма добавления отзыва -->
<div id="add-review-form" style="display: none;">
    <h2>Добавить отзыв</h2>
    <form action="/admin/add-review" method="POST">
        <div class="form-group">
            <label>Автор:</label>
            <input type="text" name="author" required>
        </div>
        <div class="form-group">
            <label>Продукт:</label>
            <select name="product_id" required>
                {% for product in products %}
                <option value="{{ product.id }}">{{ product.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label>Текст:</label>
            <textarea name="text" required></textarea>
        </div>
        <div class="form-group">
            <label>Оценка (1-5):</label>
            <input type="number" name="rating" min="1" max="5" required>
        </div>
        <button type="submit" class="admin-btn btn-reset">Добавить</button>
    </form>
</div>

<!-- Форма редактирования отзыва -->
<div id="edit-review-form" style="display: none;">
    <h2>Редактировать отзыв</h2>
    <form id="editReviewForm" method="POST">
        <div class="form-group">
            <label>Текст:</label>
            <textarea name="text" id="editReviewText" required></textarea>
        </div>
        <div class="form-group">
            <label>Оценка (1-5):</label>
            <input type="number" name="rating" id="editReviewRating" min="1" max="5" required>
        </div>
        <button type="submit" class="admin-btn btn-reset">Сохранить</button>
    </form>
</div>

<!-- Добавить кнопки управления -->
<div class="admin-controls">
    <button onclick="toggleForm('add-user-form')" class="admin-btn btn-reset">Добавить пользователя</button>
    <button onclick="toggleForm('add-product-form')" class="admin-btn btn-reset">Добавить продукт</button>
    <button onclick="toggleForm('add-cart-form')" class="admin-btn btn-reset">Добавить в корзину</button>
    <button onclick="toggleForm('add-review-form')" class="admin-btn btn-reset">Добавить отзыв</button>
</div>


<script>
    function showTable(tableName) {
        document.querySelectorAll('.admin-table').forEach(t => t.style.display = 'none');
        document.getElementById(`${tableName}-table`).style.display = 'table';
    }
    showTable('users');// Добавить функции для редактирования
function editCart(cart) {
    document.getElementById('editCartQuantity').value = cart.quantity;
    document.getElementById('editCartForm').action = `/admin/edit-cart/${cart.id}`;
    toggleForm('edit-cart-form');
}

    function editReview(review) {
    document.getElementById('editReviewText').value = review.text;
    document.getElementById('editReviewRating').value = review.rating;
    document.getElementById('editReviewForm').action = `/admin/edit-review/${review.id}`;
    toggleForm('edit-review-form');}

    function editProduct(product) {
    // Заполняем форму текущими данными продукта
    document.getElementById('editProductName').value = product.name;
    document.getElementById('editProductCategory').value = product.category;
    document.getElementById('editProductPrice').value = product.price;
    document.getElementById('editProductDescription').value = product.description;

    // Устанавливаем action для формы
    document.getElementById('editProductForm').action = `/admin/edit-product/${product.id}`;

    // Отображаем форму редактирования
    toggleForm('edit-product-form');
}
</script>
{% endblock %}